<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examples | TrussC</title>
    <meta name="description" content="TrussC interactive examples running in WebAssembly. Try them in your browser.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="examples.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-text">TrussC</span>
            </a>
            <button class="nav-toggle" aria-label="Open menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-links">
                <li><a href="index.html" class="active">Examples</a></li>
                <li><a href="../for-of-users.html">For oF Users</a></li>
                <li><a href="https://gemini.google.com/gem/16aq3ccVPl33j6xSMyE7MWXDjaZvauL0I" target="_blank" rel="noopener">Ask AI</a></li>
                <li><a href="https://github.com/TrussC-org/TrussC/blob/main/docs/GET_STARTED.md" class="nav-cta" target="_blank" rel="noopener">Get Started</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="examples-hero">
        <div class="container">
            <h1 class="examples-hero-title">Examples</h1>
            <p class="examples-hero-description">
                Interactive demos running in your browser via WebAssembly.<br>
                Click any example to try it live.
            </p>
        </div>
    </header>

    <!-- Examples by Category -->
    <section class="section">
        <div class="container">
            <div id="examples-container">
                <div class="loading">Loading examples...</div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 TrussC. Released under the <a href="../license.html">MIT License</a>.</p>
            </div>
        </div>
    </footer>

    <script src="../script.js"></script>
    <script>
        const WASM_BASE_URL = 'https://wasm.trussc.org';

        // カテゴリー表示名
        const categoryNames = {
            '3d': '3D',
            'events': 'Events',
            'graphics': 'Graphics',
            'gui': 'GUI',
            'input_output': 'Input / Output',
            'math': 'Math',
            'network': 'Network',
            'sound': 'Sound',
            'templates': 'Templates',
            'threads': 'Threads',
            'utils': 'Utilities',
            'video': 'Video',
            'windowing': 'Windowing'
        };

        // カテゴリー表示順
        const categoryOrder = [
            'graphics', '3d', 'input_output', 'events', 'gui',
            'math', 'sound', 'utils', 'video', 'network', 'threads', 'windowing', 'templates'
        ];

        async function loadExamples() {
            try {
                const response = await fetch(`${WASM_BASE_URL}/samples.json`);
                if (!response.ok) throw new Error('Failed to load samples.json');
                const data = await response.json();
                renderExamples(data);
            } catch (error) {
                console.error('Error loading examples:', error);
                document.getElementById('examples-container').innerHTML = `
                    <div class="error-message">
                        <p>Failed to load examples. Please try again later.</p>
                    </div>
                `;
            }
        }

        function renderExamples(data) {
            const container = document.getElementById('examples-container');
            const isWebSupported = (example) => example.webSupported !== false;

            // カテゴリーごとにグループ化
            const byCategory = {};
            data.examples.forEach(e => {
                const cat = e.category || 'other';
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(e);
            });

            // カード生成関数
            const renderCard = (example) => `
                <a href="player.html?name=${example.name}" class="example-card${isWebSupported(example) ? '' : ' not-web-supported'}">
                    <div class="example-thumb">
                        <img src="${WASM_BASE_URL}/${example.thumb}" alt="${example.title}" loading="lazy">
                        ${isWebSupported(example) ? '' : '<div class="example-unsupported-overlay">Native only</div>'}
                    </div>
                    <div class="example-info">
                        <h3 class="example-title">${example.title}</h3>
                    </div>
                </a>
            `;

            // カテゴリーセクション生成
            let html = '';
            categoryOrder.forEach(cat => {
                if (byCategory[cat] && byCategory[cat].length > 0) {
                    html += `
                        <div class="category-section">
                            <h2 class="category-title">${categoryNames[cat] || cat}</h2>
                            <div class="examples-grid">
                                ${byCategory[cat].map(renderCard).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            // Addonsセクション
            if (data.addons && data.addons.length > 0) {
                // addonごとにグループ化
                const byAddon = {};
                data.addons.forEach(e => {
                    const addon = e.addon || 'other';
                    if (!byAddon[addon]) byAddon[addon] = [];
                    byAddon[addon].push(e);
                });

                html += `<div class="category-section addons-section">
                    <h2 class="category-title">Addons</h2>`;

                Object.keys(byAddon).forEach(addon => {
                    html += `
                        <div class="addon-group">
                            <h3 class="addon-title">${addon}</h3>
                            <div class="examples-grid">
                                ${byAddon[addon].map(renderCard).join('')}
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            }

            container.innerHTML = html;
        }

        loadExamples();
    </script>
</body>
</html>
